const main=document.getElementById("main"),_console=document.getElementById("console"),_input=document.getElementById("input"),_c_highdpi=document.getElementById("_c_highdpi"),config_container=document.getElementById("config_container"),_c_preview_view=document.getElementById("_c_preview_view"),_c_preview_hide=document.getElementById("_c_preview_hide"),_c_wipe_pages=document.getElementById("_c_wipe_pages"),_c_restore_pages=document.getElementById("_c_restore_pages"),_c_delete_page=document.getElementById("_c_delete_page"),_c_crop_page=document.getElementById("_c_crop_page"),_c_rotate_page=document.getElementById("_c_rotate_page"),_c_move_doc_left=document.getElementById("_c_move_doc_left"),_c_move_doc_right=document.getElementById("_c_move_doc_right"),preview_container=document.getElementById("preview_container"),preview_canvas=document.getElementById("preview_canvas"),multipage_help=document.getElementById("multipage_help"),multipage_prev=document.getElementById("multipage_prev"),multipage_next=document.getElementById("multipage_next"),multipage_count=document.getElementById("multipage_count"),_c_split_label=document.getElementById("_c_split_label"),_c_split=document.getElementById("_c_split"),action_button=document.getElementById("action_button"),bottom_info=document.getElementById("bottom_info");var split=!1,isCropping=!1,fileBuffers=[null],PDFDocs=[null],numPages=[null],pageHelp={current:null,total:null,delete:[null],rotate:[null]},previewWindow={scale:null,lastTouchesDist:null,lastX:null,lastY:null,offsetX:null,offsetY:null,isDragging:null,isTouchZooming:null},cropRect={x:0,y:0,w:0,h:0,lastX:0,lastY:0,offsetX:0,offsetY:0,vertex:0,dragging:!1},cropArray={saved:[{x:null,y:null,w:null,h:null}],sizes:[{pw:null,ph:null}]};function resetFileBuffers(){fileBuffers=[]}function resetPDFDocs(){PDFDocs=[]}function resetNumPages(){numPages=[]}function resetPageHelp(){pageHelp={current:1,total:null,delete:[],rotate:[]}}function resetPreviewWindow(){previewWindow={scale:1,lastTouchesDist:0,lastX:0,lastY:0,offsetX:0,offsetY:0,isDragging:!1,isTouchZooming:!1}}function resetCurrentCrop(e){cropRect={x:0,y:0,w:e.width-1,h:e.height-1,lastX:0,lastY:0,offsetX:0,offsetY:0,vertex:0,dragging:!1}}function resetCropArray(){cropArray={saved:[],sizes:[]}}function saveCurrentCrop(e){const t=pageHelp.current-1,o=cropRect.x,n=cropRect.y,r=cropRect.w,c=cropRect.h;cropArray.saved[t]={x:o,y:n,w:r,h:c};const i=e.width-1,a=e.height-1;cropArray.sizes[t]={pw:i,ph:a}}function restoreCurrentCrop(e,t){0!=cropArray.saved[e-1].w?cropRect={x:cropArray.saved[e-1].x,y:cropArray.saved[e-1].y,w:cropArray.saved[e-1].w,h:cropArray.saved[e-1].h,lastX:0,lastY:0,offsetX:0,offsetY:0,vertex:0,dragging:!1}:resetCurrentCrop(t)}function whatDoc(e){var t=0,o=e;for(let e=0;e<PDFDocs.length;e++){if(!(o>numPages[e]))return t;o-=numPages[e],t++}}function whatPage(e){var t=e;for(let e=0;e<PDFDocs.length;e++){if(!(t>numPages[e]))return t;t-=numPages[e]}}function updatePageCount(){multipage_count.innerHTML="p:"+whatPage(pageHelp.current)+"/"+numPages[whatDoc(pageHelp.current)]+", ",multipage_count.innerHTML+="d:"+(whatDoc(pageHelp.current)+1)+"/"+(whatDoc(pageHelp.total)+1)}var renderInProgress=!1;async function renderPDFPage(e){var t,o=e;for(let e=0;e<PDFDocs.length;e++){if(!(o>numPages[e])){t=await PDFDocs[e].getPage(o);break}o-=numPages[e]}const n=t.getViewport({scale:CONST_DPI/72});canvas.width=n.width>=800?800:n.width,canvas.height=n.height>=800?800:n.height,vCanvas.width=n.width,vCanvas.height=n.height;const r=t.render({canvasContext:vContext,viewport:n});await r.promise}async function renderMoveWrap(e){renderInProgress=!0,saveCurrentCrop(vCanvas),pageHelp.current+=e,await renderPDFPage(pageHelp.current),restoreCurrentCrop(pageHelp.current,vCanvas),draw(),0!=e&&updatePageCount(),renderInProgress=!1}function swapRight(e,t,o,n,r){const c=e.slice(t,t+n),i=e.slice(o,o+r);e.splice(t,n+r,...i,...c)}async function renderSwapWrap(e,t){renderInProgress=!0,saveCurrentCrop(vCanvas);let o=0;if(0!=e)for(let t=0;t<e;t++)o+=numPages[t];1==t?(swapRight(pageHelp.rotate,o,o+numPages[e],numPages[e],numPages[e+1]),swapRight(pageHelp.delete,o,o+numPages[e],numPages[e],numPages[e+1]),swapRight(cropArray.saved,o,o+numPages[e],numPages[e],numPages[e+1]),swapRight(cropArray.sizes,o,o+numPages[e],numPages[e],numPages[e+1])):-1==t&&(swapRight(pageHelp.rotate,o-numPages[e-1],o,numPages[e-1],numPages[e]),swapRight(pageHelp.delete,o-numPages[e-1],o,numPages[e-1],numPages[e]),swapRight(cropArray.saved,o-numPages[e-1],o,numPages[e-1],numPages[e]),swapRight(cropArray.sizes,o-numPages[e-1],o,numPages[e-1],numPages[e]));const n=fileBuffers[e],r=PDFDocs[e],c=numPages[e];fileBuffers[e]=fileBuffers[e+t],PDFDocs[e]=PDFDocs[e+t],numPages[e]=numPages[e+t],fileBuffers[e+t]=n,PDFDocs[e+t]=r,numPages[e+t]=c,await renderPDFPage(pageHelp.current),restoreCurrentCrop(pageHelp.current,vCanvas),draw(),updatePageCount(),renderInProgress=!1}function printConsole(e){_console.value+=e,_console.scrollTop=_console.scrollHeight}function resetConsole(){_console.value=""}const canvas=document.getElementById("canvas"),context=canvas.getContext("2d");context.imageSmoothingEnabled=!1;const vCanvas=document.createElement("canvas"),vContext=vCanvas.getContext("2d");vContext.imageSmoothingEnabled=!1;var CONST_DPI=144;const CONST_CROPTHICKNESS=1,CONST_CROPSQUAREAREA=16,CONST_ZOOMFACTOR=1.1,CONST_MOBILEZOOMFACTOR=1.05;function draw(){if(context.setTransform(1,0,0,1,0,0),context.clearRect(0,0,canvas.width,canvas.height),context.imageSmoothingEnabled=!1,context.setTransform(previewWindow.scale,0,0,previewWindow.scale,previewWindow.offsetX,previewWindow.offsetY),0!=pageHelp.rotate[pageHelp.current-1]&&0==isCropping&&(context.translate(vCanvas.width/2,vCanvas.height/2),context.rotate(pageHelp.rotate[pageHelp.current-1]*Math.PI/2),context.translate(-1*vCanvas.width/2,-1*vCanvas.height/2)),context.drawImage(vCanvas,0,0),1==pageHelp.delete[pageHelp.current-1])context.strokeStyle="red",context.lineWidth=2,context.fillStyle="rgba(0, 0, 0, 0.5)",context.fillRect(0,0,vCanvas.width,vCanvas.height),context.beginPath(),context.moveTo(0,0),context.lineTo(vCanvas.width,vCanvas.height),context.stroke(),context.beginPath(),context.moveTo(vCanvas.width,0),context.lineTo(0,vCanvas.height),context.stroke();else{const e=Math.round(cropRect.x),t=Math.round(cropRect.y),o=Math.round(cropRect.w),n=Math.round(cropRect.h);1==isCropping&&(context.fillStyle="red",context.fillRect(e+1-CONST_CROPSQUAREAREA,t+1-CONST_CROPSQUAREAREA,CONST_CROPSQUAREAREA,CONST_CROPSQUAREAREA),context.fillRect(e+1-CONST_CROPSQUAREAREA,t+n,CONST_CROPSQUAREAREA,CONST_CROPSQUAREAREA),context.fillRect(e+o,t+1-CONST_CROPSQUAREAREA,CONST_CROPSQUAREAREA,CONST_CROPSQUAREAREA),context.fillRect(e+o,t+n,CONST_CROPSQUAREAREA,CONST_CROPSQUAREAREA)),context.save(),context.fillStyle="rgba(0, 0, 0, 0.25)",context.fillRect(e,t,o,n),context.restore(),context.strokeStyle="rgba(255, 0, 0 , 0.6)",context.lineWidth=CONST_CROPTHICKNESS,context.strokeRect(e+CONST_CROPTHICKNESS/2,t+CONST_CROPTHICKNESS/2,o,n)}}function press(e,t){const o=canvas.getBoundingClientRect();previewWindow.isDragging=!0,previewWindow.isTouchZooming=!1,previewWindow.lastX=e-o.left,previewWindow.lastY=t-o.top}function move(e,t){if(!previewWindow.isDragging||previewWindow.isTouchZooming)return;const o=canvas.getBoundingClientRect(),n=e-o.left-previewWindow.lastX,r=t-o.top-previewWindow.lastY;previewWindow.offsetX+=n,previewWindow.offsetY+=r,previewWindow.lastX=e-o.left,previewWindow.lastY=t-o.top,draw()}function zoom(e){const t=canvas.getBoundingClientRect(),o=e.clientX-t.left,n=e.clientY-t.top,r=e.deltaY<=0?1.1:1/1.1,c=(o-previewWindow.offsetX)/previewWindow.scale,i=(n-previewWindow.offsetY)/previewWindow.scale;previewWindow.scale*=r,previewWindow.offsetX=o-c*previewWindow.scale,previewWindow.offsetY=n-i*previewWindow.scale,draw()}function end(){previewWindow.isDragging=!1,cropRect.dragging=!1,canvas.classList.remove("grabbing")}function getTouchesDist(e,t){const o=e.clientX-t.clientX,n=e.clientY-t.clientY;return Math.hypot(o,n)}function getTouchesX(e,t){return(e.clientX+t.clientX)/2}function getTouchesY(e,t){return(e.clientY+t.clientY)/2}function mobileStartZoom(e,t){cropRect.dragging=!1,previewWindow.isDragging=!1,previewWindow.isTouchZooming=!0,previewWindow.lastTouchesDist=getTouchesDist(e,t)}function mobileZoom(e,t){const o=canvas.getBoundingClientRect(),n=getTouchesX(e,t)-o.left,r=getTouchesY(e,t)-o.top,c=getTouchesDist(e,t)-previewWindow.lastTouchesDist<=0?1/1.05:1.05,i=(n-previewWindow.offsetX)/previewWindow.scale,a=(r-previewWindow.offsetY)/previewWindow.scale;previewWindow.scale*=c,previewWindow.offsetX=n-i*previewWindow.scale,previewWindow.offsetY=r-a*previewWindow.scale,previewWindow.lastTouchesDist=getTouchesDist(e,t),draw()}function mobileEnd(){previewWindow.isDragging=!1,previewWindow.isTouchZooming=!1}function hideWhenCropping(){_c_preview_hide.classList.toggle("notallowed"),multipage_prev.classList.toggle("notallowed"),multipage_next.classList.toggle("notallowed"),_c_wipe_pages.classList.toggle("notallowed"),_c_delete_page.classList.toggle("notallowed"),_c_restore_pages.classList.toggle("notallowed"),_c_rotate_page.classList.toggle("notallowed"),_c_move_doc_left.classList.toggle("notallowed"),_c_move_doc_right.classList.toggle("notallowed")}function toPt(e){return e*(72/CONST_DPI)}async function action(e){let t=0;for(let e=0;e<pageHelp.total;e++)0!=pageHelp.delete[e]?t++:0!=pageHelp.rotate[e]&&0;if(t==pageHelp.total)return void printConsole("Error: Aborting download of zero pages.\n");const{PDFDocument:o}=PDFLib,n=await o.create();let r=0;for(let e=0;e<fileBuffers.length;e++){0!=e&&(r+=numPages[e-1]);const t=await o.load(fileBuffers[e]);for(let o=1;o<=numPages[e];o++){const e=t.getPages()[o-1];if(0!=cropArray.saved[r+o-1].w&&0!=cropArray.saved[r+o-1].h){const t=cropArray.saved[r+o-1],n=cropArray.sizes[r+o-1].pw,c=cropArray.sizes[r+o-1].ph,i=Math.round(t.x),a=c-Math.round(t.h)-Math.round(t.y),s=Math.round(t.w),p=Math.round(t.h),l=e.getCropBox();0==i&&0==a&&s==n&&p==c||(e.setCropBox(toPt(i)+l.x,toPt(a)+l.y,toPt(s),toPt(p)),printConsole("Done: Page "+(r+o)+" cropped with params ("+toPt(i)+", "+toPt(a)+", "+toPt(s)+", "+toPt(p)+").\n")),0==l.x&&0==l.y&&Math.round(l.width)==toPt(s)&&Math.round(l.height)==toPt(p)||printConsole("Info: Page "+(r+o)+" had a cropbox prior to addition.\n")}0!=pageHelp.rotate[r+o-1]&&(e.setRotation(PDFLib.degrees(e.getRotation().angle+90*pageHelp.rotate[r+o-1])),printConsole("Done: Page "+(r+o)+" rotated with angle "+90*pageHelp.rotate[r+o-1]+"Â° clockwise.\n"))}(await n.copyPages(t,t.getPageIndices())).forEach((e=>n.addPage(e)))}r=pageHelp.total-1;for(let t=fileBuffers.length-1;t>=0;t--){t!=fileBuffers.length-1&&(r-=numPages[t+1]);for(let c=1;c<=numPages[t];c++)if(e&&0==pageHelp.delete[r-c+1]){const e=await o.create(),[t]=await e.copyPages(n,[r-c+1]);e.addPage(t);const i=await e.save(),a=new Blob([i],{type:"application/pdf"}),s=document.createElement("a");s.href=URL.createObjectURL(a),s.download="converted-"+(r-c+1)+".pdf",s.click(),URL.revokeObjectURL(s.href)}else 1==pageHelp.delete[r-c+1]&&(n.removePage(r-c+1),printConsole("Done: Page "+(r-c+2)+" deleted.\n"))}if(e)return;newBytes=await n.save();const c=new Blob([newBytes],{type:"application/pdf"}),i=document.createElement("a");i.href=URL.createObjectURL(c),i.download="merged.pdf",i.click(),URL.revokeObjectURL(i.href)}canvas.addEventListener("wheel",(e=>{e.preventDefault(),zoom(e)})),canvas.addEventListener("mousedown",(e=>{canvas.classList.add("grabbing");const t=canvas.getBoundingClientRect(),o=e.clientX-t.left,n=e.clientY-t.top,r=cropRect.x*previewWindow.scale+previewWindow.offsetX,c=cropRect.y*previewWindow.scale+previewWindow.offsetY,i=cropRect.w*previewWindow.scale,a=cropRect.h*previewWindow.scale;1==isCropping&&o>=r-previewWindow.scale-10&&o<=r+previewWindow.scale+10&&n>=c-previewWindow.scale-10&&n<=c+previewWindow.scale+10?(cropRect.lastX=(o-previewWindow.offsetX)/previewWindow.scale,cropRect.lastY=(n-previewWindow.offsetY)/previewWindow.scale,cropRect.offsetX=0,cropRect.offsetY=0,cropRect.vertex=0,cropRect.dragging=!0):1==isCropping&&o>=r+i-previewWindow.scale-10&&o<=r+i+previewWindow.scale+10&&n>=c-previewWindow.scale-10&&n<=c+previewWindow.scale+10?(cropRect.lastX=(o-previewWindow.offsetX)/previewWindow.scale,cropRect.lastY=(n-previewWindow.offsetY)/previewWindow.scale,cropRect.offsetX=0,cropRect.offsetY=0,cropRect.vertex=1,cropRect.dragging=!0):1==isCropping&&o>=r-previewWindow.scale-10&&o<=r+previewWindow.scale+10&&n>=c+a-previewWindow.scale-10&&n<=c+a+previewWindow.scale+10?(cropRect.lastX=(o-previewWindow.offsetX)/previewWindow.scale,cropRect.lastY=(n-previewWindow.offsetY)/previewWindow.scale,cropRect.offsetX=0,cropRect.offsetY=0,cropRect.vertex=2,cropRect.dragging=!0):1==isCropping&&o>=r+i-previewWindow.scale-10&&o<=r+i+previewWindow.scale+10&&n>=c+a-previewWindow.scale-10&&n<=c+a+previewWindow.scale+10?(cropRect.lastX=(o-previewWindow.offsetX)/previewWindow.scale,cropRect.lastY=(n-previewWindow.offsetY)/previewWindow.scale,cropRect.offsetX=0,cropRect.offsetY=0,cropRect.vertex=3,cropRect.dragging=!0):press(e.clientX,e.clientY)})),canvas.addEventListener("mousemove",(e=>{e.preventDefault();const t=canvas.getBoundingClientRect(),o=e.clientX-t.left,n=e.clientY-t.top;if(1==cropRect.dragging){const e=(o-cropRect.offsetX-previewWindow.offsetX)/previewWindow.scale,t=(n-cropRect.offsetY-previewWindow.offsetY)/previewWindow.scale;let r=e-cropRect.lastX,c=t-cropRect.lastY;switch(cropRect.vertex){case 0:cropRect.x+=r,cropRect.y+=c,cropRect.w-=r,cropRect.h-=c;break;case 1:cropRect.y+=c,cropRect.w+=r,cropRect.h-=c;break;case 2:cropRect.x+=r,cropRect.w-=r,cropRect.h+=c;break;case 3:cropRect.w+=r,cropRect.h+=c}cropRect.lastX=e,cropRect.lastY=t,draw()}else move(e.clientX,e.clientY)})),canvas.addEventListener("mouseup",(()=>{end()})),canvas.addEventListener("mouseleave",(()=>{end()})),canvas.addEventListener("touchstart",(function(e){if(e.preventDefault(),1==e.touches.length){const t=canvas.getBoundingClientRect(),o=e.touches[0].clientX-t.left,n=e.touches[0].clientY-t.top,r=cropRect.x*previewWindow.scale+previewWindow.offsetX,c=cropRect.y*previewWindow.scale+previewWindow.offsetY,i=cropRect.w*previewWindow.scale,a=cropRect.h*previewWindow.scale;1==isCropping&&o>=r-previewWindow.scale-20&&o<=r+previewWindow.scale+20&&n>=c-previewWindow.scale-20&&n<=c+previewWindow.scale+20?(cropRect.lastX=(o-previewWindow.offsetX)/previewWindow.scale,cropRect.lastY=(n-previewWindow.offsetY)/previewWindow.scale,cropRect.offsetX=0,cropRect.offsetY=0,cropRect.vertex=0,cropRect.dragging=!0):1==isCropping&&o>=r+i-previewWindow.scale-20&&o<=r+i+previewWindow.scale+20&&n>=c-previewWindow.scale-20&&n<=c+previewWindow.scale+20?(cropRect.lastX=(o-previewWindow.offsetX)/previewWindow.scale,cropRect.lastY=(n-previewWindow.offsetY)/previewWindow.scale,cropRect.offsetX=0,cropRect.offsetY=0,cropRect.vertex=1,cropRect.dragging=!0):1==isCropping&&o>=r-previewWindow.scale-20&&o<=r+previewWindow.scale+20&&n>=c+a-previewWindow.scale-20&&n<=c+a+previewWindow.scale+20?(cropRect.lastX=(o-previewWindow.offsetX)/previewWindow.scale,cropRect.lastY=(n-previewWindow.offsetY)/previewWindow.scale,cropRect.offsetX=0,cropRect.offsetY=0,cropRect.vertex=2,cropRect.dragging=!0):1==isCropping&&o>=r+i-previewWindow.scale-20&&o<=r+i+previewWindow.scale+20&&n>=c+a-previewWindow.scale-20&&n<=c+a+previewWindow.scale+20?(cropRect.lastX=(o-previewWindow.offsetX)/previewWindow.scale,cropRect.lastY=(n-previewWindow.offsetY)/previewWindow.scale,cropRect.offsetX=0,cropRect.offsetY=0,cropRect.vertex=3,cropRect.dragging=!0):press(e.touches[0].clientX,e.touches[0].clientY)}else 2==e.touches.length&&mobileStartZoom(e.touches[0],e.touches[1])}),{passive:!1}),canvas.addEventListener("touchmove",(function(e){if(e.preventDefault(),1==e.touches.length)if(1==cropRect.dragging){const t=canvas.getBoundingClientRect(),o=e.touches[0].clientX-t.left,n=e.touches[0].clientY-t.top,r=(o-cropRect.offsetX-previewWindow.offsetX)/previewWindow.scale,c=(n-cropRect.offsetY-previewWindow.offsetY)/previewWindow.scale;let i=r-cropRect.lastX,a=c-cropRect.lastY;switch(cropRect.vertex){case 0:cropRect.x+=i,cropRect.y+=a,cropRect.w-=i,cropRect.h-=a;break;case 1:cropRect.y+=a,cropRect.w+=i,cropRect.h-=a;break;case 2:cropRect.x+=i,cropRect.w-=i,cropRect.h+=a;break;case 3:cropRect.w+=i,cropRect.h+=a}cropRect.lastX=r,cropRect.lastY=c,draw()}else move(e.touches[0].clientX,e.touches[0].clientY);else 2==e.touches.length&&mobileZoom(e.touches[0],e.touches[1])}),{passive:!1}),canvas.addEventListener("touchend",(()=>{mobileEnd()}),{passive:!1}),canvas.addEventListener("touchcancel",(()=>{mobileEnd()}),{passive:!1}),_c_highdpi.addEventListener("change",(e=>{CONST_DPI=e.target.checked?288:144,config_container.classList.add("hidden")})),_c_preview_view.addEventListener("click",(function(){preview_container.classList.toggle("hidden"),main.classList.toggle("blurred"),bottom_info.classList.toggle("blurred")})),_c_preview_hide.addEventListener("click",(function(){1!=isCropping&&(saveCurrentCrop(vCanvas),preview_container.classList.toggle("hidden"),main.classList.toggle("blurred"),bottom_info.classList.toggle("blurred"))})),multipage_prev.addEventListener("click",(async function(){1!=isCropping&&(1==pageHelp.current||renderInProgress||await renderMoveWrap(-1))})),multipage_next.addEventListener("click",(async function(){1!=isCropping&&(pageHelp.current==pageHelp.total||renderInProgress||await renderMoveWrap(1))})),_c_wipe_pages.addEventListener("click",(()=>{if(1!=isCropping){for(let e=1;e<=pageHelp.total;e++)pageHelp.delete[e-1]=1;draw()}})),_c_restore_pages.addEventListener("click",(()=>{if(1!=isCropping){for(let e=1;e<=pageHelp.total;e++)pageHelp.delete[e-1]=0;draw()}})),_c_delete_page.addEventListener("click",(()=>{1!=isCropping&&(pageHelp.delete[pageHelp.current-1]=0==pageHelp.delete[pageHelp.current-1]?1:0,draw())})),_c_crop_page.addEventListener("click",(()=>{1!=pageHelp.delete[pageHelp.current-1]&&(isCropping=1!=isCropping,_c_crop_page.classList.toggle("bg-gray"),canvas.classList.toggle("crosshair"),hideWhenCropping(),draw())})),_c_rotate_page.addEventListener("click",(()=>{1!=isCropping&&(pageHelp.rotate[pageHelp.current-1]=(pageHelp.rotate[pageHelp.current-1]+1)%4,draw())})),_c_move_doc_left.addEventListener("click",(async function(){if(1==isCropping)return;let e=whatDoc(pageHelp.current);0==e||renderInProgress||await renderSwapWrap(e,-1)})),_c_move_doc_right.addEventListener("click",(async function(){if(1==isCropping)return;let e=whatDoc(pageHelp.current);e==PDFDocs.length-1||renderInProgress||await renderSwapWrap(e,1)})),_input.addEventListener("drop",(e=>{e.preventDefault();const t=e.dataTransfer.files;if(!t||0===t.length)return;if(t.length>=20)return void printConsole("Error: Received over 20 files.\n");const o=new DataTransfer;for(let e=0;e<t.length;e++)"application/pdf"==t[e].type&&o.items.add(t[e]);_input.files=o.files,_input.dispatchEvent(new Event("change"))})),pdfjsLib.GlobalWorkerOptions.workerSrc="libs/pdf.worker.min.js",_input.onchange=async e=>{preview_container.classList.add("hidden"),config_container.classList.add("hidden"),_c_wipe_pages.classList.add("hidden"),_c_restore_pages.classList.add("hidden"),_c_delete_page.classList.add("hidden"),_c_move_doc_left.classList.add("hidden"),_c_move_doc_right.classList.add("hidden"),_c_split_label.classList.add("hidden"),multipage_help.classList.add("hidden"),resetConsole(),resetFileBuffers(),resetPDFDocs(),resetNumPages(),resetPageHelp(),resetPreviewWindow(),resetCropArray();const t=e.target.files;if(t&&0!==t.length)if(t.length>=20)printConsole("Error: Received over 20 files.\n");else{for(let e=0;e<t.length;e++){if("application/pdf"!=t[e].type)return void printConsole("Error: Received a non-PDF file.\n");const o=await t[e].arrayBuffer();fileBuffers.push(o.slice(0)),PDFDocs.push(await pdfjsLib.getDocument({data:o}).promise),numPages.push(PDFDocs[e].numPages),pageHelp.total+=PDFDocs[e].numPages;for(let t=0;t<PDFDocs[e].numPages;t++)pageHelp.rotate.push(0),pageHelp.delete.push(0),cropArray.saved.push({x:0,y:0,w:0,h:0}),cropArray.sizes.push({pw:0,ph:0})}await renderMoveWrap(0),resetCurrentCrop(vCanvas),draw(),config_container.classList.remove("hidden"),(PDFDocs.length>1||numPages[0]>1)&&(PDFDocs.length>1&&(_c_move_doc_left.classList.remove("hidden"),_c_move_doc_right.classList.remove("hidden")),_c_restore_pages.classList.remove("hidden"),_c_wipe_pages.classList.remove("hidden"),_c_delete_page.classList.remove("hidden"),multipage_help.classList.remove("hidden"),_c_split_label.classList.remove("hidden"),updatePageCount())}else printConsole("Error: Received 0 files.\n")},_c_split.addEventListener("change",(e=>{split=!!e.target.checked})),action_button.addEventListener("click",(async function(){resetConsole(),action(split)}));